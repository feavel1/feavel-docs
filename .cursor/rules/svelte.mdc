# Svelte 5 & SvelteKit Rules

## Project Overview

This is a SvelteKit-based SaaS documentation platform with bun, Supabase backend, Shadcn-Svelte UI components, and Paraglide.js internationalization.

## Core Technologies

- **Bun** as package manager and runtime
- **SvelteKit 2.x** with Svelte 5 runes
- **Supabase** for backend (auth, database, storage)
- **Shadcn-Svelte** for UI components
- **Tailwind CSS 4.x** for styling
- **Paraglide.js** for internationalization
- **TypeScript** with strict mode

## Svelte 5 Runes Usage

Always use Svelte 5 runes for state management:

```typescript
// State declaration
let count = $state(0);

// Derived values
let doubled = $derived(count * 2);

// Effects
$effect(() => {
	console.log(`Count is now ${count}`);
});

// Props
let { optionalProp = 42, requiredProp } = $props();

// Bindable props
let { bindableProp = $bindable() } = $props();
```

## Project Structure

```
src/
├── lib/
│   ├── components/
│   │   ├── ui/          # Shadcn-Svelte components
│   │   └── modules/     # Reusable module components
│   ├── utils/           # Utility functions
│   └── hooks/           # Custom hooks
├── routes/
│   ├── auth/            # Authentication pages
│   ├── member/          # Member profile pages
│   ├── demo/            # Demo pages
│   └── api/             # API routes
├── app.html             # HTML template
├── app.css              # Global styles
├── app.d.ts             # TypeScript declarations
├── hooks.server.ts      # Server-side hooks
└── hooks.ts             # Client-side hooks
```

## Code Style and Structure

- Write concise, technical TypeScript code with accurate Svelte 5 examples
- Use functional and declarative programming patterns
- Avoid unnecessary classes except for state machines
- Prefer iteration and modularization over code duplication
- Structure files: component logic, markup, styles, helpers, types

## Naming Conventions

- Use lowercase with hyphens for component files (e.g., `auth-form.svelte`)
- Use PascalCase for component names in imports and usage
- Use camelCase for variables, functions, and props
- Use kebab-case for route files and directories

## TypeScript Usage

- Use TypeScript for all code; prefer interfaces over types
- Avoid enums; use const objects instead
- Use functional components with TypeScript interfaces for props
- Enable strict mode in TypeScript for better type safety

## UI and Styling with Shadcn-Svelte

- Use Tailwind CSS for utility-first styling approach
- Leverage Shadcn-Svelte components for pre-built, customizable UI elements
- Import Shadcn-Svelte components from `$lib/components/ui`
- Organize Tailwind classes using the `cn()` utility from `$lib/utils`

### Available UI Components

- **Layout**: Accordion, Card, Drawer, Dialog, Popover
- **Navigation**: Breadcrumb, Navigation Menu, Command, Menubar
- **Forms**: Form, Input, Label, Radio Group, Input OTP
- **Data Display**: Table, Data Table, Badge, Avatar, Progress
- **Feedback**: Alert Dialog, Context Menu, Dropdown Menu, Hover Card
- **Pagination**: Pagination components

### Color System

Use Shadcn color conventions:

```css
--background, --foreground: Default body colors
--muted, --muted-foreground: Muted backgrounds
--card, --card-foreground: Card backgrounds
--popover, --popover-foreground: Popover backgrounds
--border: Default border color
--input: Input border color
--primary, --primary-foreground: Primary button colors
--secondary, --secondary-foreground: Secondary button colors
--accent, --accent-foreground: Accent colors
--destructive, --destructive-foreground: Destructive action colors
--ring: Focus ring color
--radius: Border radius for components
```

## Component Development

- Create .svelte files for Svelte components
- Use .svelte.ts files for component logic and state machines
- Implement proper component composition and reusability
- Use Svelte's props for data passing
- Leverage Svelte's reactive declarations for local state management

## State Management

Use classes for complex state management (state machines):

```typescript
// counter.svelte.ts
class Counter {
	count = $state(0);
	incrementor = $state(1);

	increment() {
		this.count += this.incrementor;
	}

	resetCount() {
		this.count = 0;
	}

	resetIncrementor() {
		this.incrementor = 1;
	}
}

export const counter = new Counter();
```

Use in components:

```svelte
<script lang="ts">
	import { counter } from './counter.svelte.ts';
</script>

<button onclick={() => counter.increment()}>
	Count: {counter.count}
</button>
```

## Routing and Pages

- Utilize SvelteKit's file-based routing system in the src/routes/ directory
- Implement dynamic routes using [slug] syntax
- Use load functions for server-side data fetching and pre-rendering
- Implement proper error handling with +error.svelte pages

## Server-Side Rendering (SSR) and Static Site Generation (SSG)

- Leverage SvelteKit's SSR capabilities for dynamic content
- Implement SSG for static pages using prerender option
- Use the adapter-auto for automatic deployment configuration

## Performance Optimization

- Leverage Svelte's compile-time optimizations
- Use `{#key}` blocks to force re-rendering of components when needed
- Implement code splitting using dynamic imports for large applications
- Profile and monitor performance using browser developer tools
- Use `$effect.tracking()` to optimize effect dependencies
- Minimize use of client-side JavaScript; leverage SvelteKit's SSR and SSG
- Implement proper lazy loading for images and other assets

## Data Fetching and API Routes

- Use load functions for server-side data fetching
- Implement proper error handling for data fetching operations
- Create API routes in the src/routes/api/ directory
- Implement proper request handling and response formatting in API routes
- Use SvelteKit's hooks for global API middleware

## SEO and Meta Tags

- Use Svelte:head component for adding meta information
- Implement canonical URLs for proper SEO
- Create reusable SEO components for consistent meta tag management

## Forms and Actions

- Utilize SvelteKit's form actions for server-side form handling
- Use `sveltekit-superforms` for form validation
- Implement Zod schemas for type safety
- Use progressive enhancement for JavaScript-optional form submissions

## Internationalization (i18n) with Paraglide.js

- Use Paraglide.js for internationalization
- Use the `m()` function for all user-facing strings
- Language files are in `messages/` directory
- Supported languages: English (en), Chinese (cn), Russian (ru)

```svelte
<script>
	import { m } from '@inlang/paraglide-js';
</script>

<h1>{m('welcome_message')}</h1>
```

## Authentication & Authorization

- Use Supabase Auth for user management
- Protected routes: `/member/*`, `/auth/*`
- Public routes: `/`, `/demo/*`
- Use `safeGetSession()` for server-side auth checks
- Implement role-based access control for verified users

## Common Patterns

### Server-side Data Fetching

```typescript
// +page.server.ts
export const load = async ({ locals }) => {
	const { session, user } = await locals.safeGetSession();
	return { session, user };
};
```

### Client-side Supabase

```typescript
// +page.svelte
<script>
  import { supabase } from '$lib/supabase/client';

  let data = $state(null);

  $effect(() => {
    const fetchData = async () => {
      const { data: result } = await supabase
        .from('table')
        .select('*');
      data = result;
    };
    fetchData();
  });
</script>
```

## Accessibility

- Ensure proper semantic HTML structure in Svelte components
- Implement ARIA attributes where necessary
- Ensure keyboard navigation support for interactive elements
- Use Svelte's bind:this for managing focus programmatically
- Follow WCAG 2.1 guidelines

## Testing

- Unit tests with Vitest
- E2E tests with Playwright
- Component testing with Vitest Browser
- Test files: `*.test.ts`, `*.spec.ts`

## Development Workflow

1. Use Bun for package management
2. Run `bun dev` for development server
3. Use `bun run check` for type checking
4. Use `bun run lint` for code linting
5. Use `bun run test` for running tests
6. Use `bun run build` for production build

## Documentation

- Svelte 5 Runes: https://svelte.dev/docs/svelte/what-are-runes
- Svelte Documentation: https://svelte.dev/docs
- SvelteKit Documentation: https://kit.svelte.dev/docs
- Paraglide.js Documentation: https://inlang.com/m/gerre34r/library-inlang-paraglideJs/sveltekit

Refer to Svelte, SvelteKit, and Paraglide.js documentation for detailed information on components, internationalization, and best practices.
